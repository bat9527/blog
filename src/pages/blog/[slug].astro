---
import Layout from '../../layouts/Layout.astro';
import Sidebar from '../../components/Sidebar.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const post = entry.data;
---

<Layout title={`${post.title} - Medium Clone`}>
  <div class="flex min-h-screen bg-white overflow-x-hidden">
    <Sidebar />
    
    <main class="flex-1 border-r border-gray-100 min-h-screen relative overflow-x-hidden">
      <div class="w-full md:max-w-3xl mx-auto py-6 md:py-12 px-4 md:px-6 animate-in fade-in duration-500">

        
        <!-- Article Meta Header -->
        <div class="flex items-center gap-2 md:gap-3 mb-6 md:mb-8">
          <a href={`${import.meta.env.BASE_URL}/`} class="text-sm text-gray-500 hover:text-gray-900 transition-colors">‚Üê Back</a>
          <div class="h-4 w-[1px] bg-gray-300"></div>
          <span class="text-sm text-gray-500">{post.publishedAt}</span>
        </div>

        <h1 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-serif font-bold text-gray-900 mb-4 md:mb-6 leading-tight">
          {post.title}
        </h1>
        <h2 class="text-lg md:text-xl text-gray-500 font-serif mb-6 md:mb-8 leading-relaxed">
          {post.subtitle}
        </h2>

        <!-- Author/Tag Block -->
        <div class="flex items-center justify-between mb-8 md:mb-12 pb-6 md:pb-8 border-b border-gray-100">
          <div class="flex items-center gap-3">
            <img src={`${import.meta.env.BASE_URL}/images/avatar.jpg`} class="w-10 h-10 rounded-full" alt="Author" />
            <div>
              <div class="text-sm font-bold text-gray-900">Written by Me</div>
              <div class="text-xs text-gray-500">{post.readTime} ¬∑ {post.tags.join(', ')}</div>
            </div>
          </div>
        </div>

        <!-- Main Image -->
        <figure class="mb-8 md:mb-12 -mx-4 md:mx-0">
          <img 
            src={post.thumbnailUrl} 
            alt="Article cover" 
            class="w-full h-auto max-h-[300px] md:max-h-[500px] object-cover md:rounded-sm"
          />
        </figure>

        <!-- Content - Enhanced Typography -->
        <article 
          class="prose prose-sm sm:prose-base md:prose-lg prose-slate font-serif max-w-none text-gray-800 leading-relaxed 
          prose-headings:font-bold prose-headings:text-gray-900 
          prose-p:leading-7 md:prose-p:leading-8 prose-p:mb-5 md:prose-p:mb-6 
          prose-a:text-green-700 prose-a:no-underline hover:prose-a:underline
          prose-blockquote:border-l-4 prose-blockquote:border-green-700 prose-blockquote:pl-4 prose-blockquote:italic prose-blockquote:text-sm md:prose-blockquote:text-base
          prose-code:bg-gray-100 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:text-pink-600
          prose-pre:bg-gray-900 prose-pre:text-gray-100 prose-pre:p-3 md:prose-pre:p-4 prose-pre:rounded-md prose-pre:text-sm prose-pre:overflow-x-auto
          prose-ul:my-4 prose-ol:my-4
          mb-12 md:mb-20"
        >
          <Content />
        </article>
        
        <!-- Footer Tags -->
        <div class="flex gap-2 mb-8 md:mb-10 flex-wrap">
          {post.tags.map((tag: string) => (
            <span class="px-3 py-1 bg-gray-100 text-sm text-gray-600 rounded-full">#{tag}</span>
          ))}
        </div>

        <div class="bg-gray-50 p-4 md:p-6 rounded-lg flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0">
          <div class="font-sans font-medium text-sm text-gray-600">
            Thanks for reading!
          </div>
          <div class="flex gap-4 md:gap-5 text-gray-500 text-sm">
            <div class="flex items-center gap-1.5">
              <span class="text-lg">üëè</span> <span>{post.claps}</span>
            </div>
            <div class="flex items-center gap-1.5">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
              </svg>
              <span>{post.comments}</span>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>
</Layout>

<style>
  .animate-in {
    animation: fadeIn 0.5s ease-in;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
